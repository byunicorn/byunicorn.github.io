<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>jQuery Source Code Study 2 - Core Module | byunicorn&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="I went through intro.js, outro.js and core/init.js in the previous post, since they are the very entry of jQuery. From now on, I will continue my work following the order defined in jQuery.js.So, my s">
<meta property="og:type" content="article">
<meta property="og:title" content="jQuery Source Code Study 2 - Core Module">
<meta property="og:url" content="http://unicorn-42.com/2014/11/30/jQuery Source Code Study 2 - Core Module/index.html">
<meta property="og:site_name" content="byunicorn's blog">
<meta property="og:description" content="I went through intro.js, outro.js and core/init.js in the previous post, since they are the very entry of jQuery. From now on, I will continue my work following the order defined in jQuery.js.So, my s">
<meta property="og:updated_time" content="2015-01-08T15:31:48.660Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="jQuery Source Code Study 2 - Core Module">
<meta name="twitter:description" content="I went through intro.js, outro.js and core/init.js in the previous post, since they are the very entry of jQuery. From now on, I will continue my work following the order defined in jQuery.js.So, my s">
  
    <link rel="alternative" href="/atom.xml" title="byunicorn&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">byunicorn&#39;s blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://unicorn-42.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-jQuery Source Code Study 2 - Core Module" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/11/30/jQuery Source Code Study 2 - Core Module/" class="article-date">
  <time datetime="2014-11-30T15:38:49.000Z" itemprop="datePublished">2014-11-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      jQuery Source Code Study 2 - Core Module
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I went through <code>intro.js</code>, <code>outro.js</code> and <code>core/init.js</code> in the <a href="http://by-unicorn.com/2014/11/25/jQuery-Source-Code-Study%201%20Basic-Structure/" target="_blank" rel="external">previous post</a>, since they are the very entry of jQuery. From now on, I will continue my work following the order defined in <code>jQuery.js</code>.<br>So, my second stop is <code>core.js</code> and <code>core/access.js</code>.<br><a id="more"></a></p>
<h2 id="Array_Like_Operation"><a href="#Array_Like_Operation" class="headerlink" title="Array Like Operation"></a>Array Like Operation</h2><p>I have mentioned in the previous post, when we use <code>$(&quot;#id&quot;)</code> or <code>$(DOMElement)</code>, the queried DOM element will be set to property “0” in jQuery object.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>[<span class="number">0</span>] = elem;</span><br></pre></td></tr></table></figure></p>
<p>Q: So what if there are mutiple result DOM elements ?<br>A: Then the second element will be kept in <code>this[1]</code>, the third one in <code>this[2]</code> and so forth. Actually the target DOM elements are stored in an array-like structure in jQuery object. Meanwhile, jQuery provides a set of array manipulating functions to handle these DOM elements, including <code>toArray</code>, <code>get</code>, <code>each</code>, <code>map</code>, <code>slice</code>, <code>first</code>, <code>last</code> and <code>eq</code>. I would like to talk about some of them.</p>
<h3 id="get__26amp_3B_26amp_3B_eq"><a href="#get__26amp_3B_26amp_3B_eq" class="headerlink" title="get &amp;&amp; eq"></a>get &amp;&amp; eq</h3><p>Both of them can be used to get the specific DOM element with index.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> divElements = $(<span class="string">"div"</span>);</span><br><span class="line">divElements.get(<span class="number">0</span>);</span><br><span class="line">divElements.eq(<span class="number">0</span>);</span><br></pre></td></tr></table></figure></p>
<p><code>get</code> returns a DOM element. If the index exceeds the array boundry, <code>get</code> will return undefined. It can also be used to convert jQuery object to dom elements, when index is not given.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">get: <span class="function"><span class="keyword">function</span>(<span class="params"> num </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> num != <span class="literal">null</span> ?</span><br><span class="line">        <span class="comment">// Return just the one element from the set</span></span><br><span class="line">        ( num &lt; <span class="number">0</span> ? <span class="keyword">this</span>[ num + <span class="keyword">this</span>.length ] : <span class="keyword">this</span>[ num ] ) :</span><br><span class="line">        <span class="comment">// Return all the elements in a clean array</span></span><br><span class="line">        slice.call( <span class="keyword">this</span> );</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<p><code>eq</code> returns a jQuery object, it merges the target DOM element into a new jQuery instance, and push the new object to the inner stack of jQuery. We will discuss the inner stack later.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">eq: <span class="function"><span class="keyword">function</span>(<span class="params"> i </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> len = <span class="keyword">this</span>.length,</span><br><span class="line">        j = +i + ( i &lt; <span class="number">0</span> ? len : <span class="number">0</span> );</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.pushStack( j &gt;= <span class="number">0</span> &amp;&amp; j &lt; len ? [ <span class="keyword">this</span>[j] ] : [] );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="each__26amp_3B_26amp_3B_map"><a href="#each__26amp_3B_26amp_3B_map" class="headerlink" title="each &amp;&amp; map"></a>each &amp;&amp; map</h3><p>The situation for this pair is a little like <code>get</code> &amp;&amp; <code>eq</code>. Both of them will apply the callback function to every element in the array.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">each: <span class="function"><span class="keyword">function</span>(<span class="params"> callback, args </span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> jQuery.each( <span class="keyword">this</span>, callback, args );</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">map: <span class="function"><span class="keyword">function</span>(<span class="params"> callback </span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">this</span>.pushStack( jQuery.map(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> elem, i </span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> callback.call( elem, i, elem );</span><br><span class="line">	&#125;));</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<p><code>each</code> will return <code>this</code>, while <code>map</code> will create a new jQuery instance, merge the callback result to this new object, then push this object to the inner stack, and return this object.</p>
<p>They both use the static functions, and there are differences between the static versions too.<br>static <code>each</code> will break the iteration, if one element’s callback result is false.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">each: <span class="function"><span class="keyword">function</span>(<span class="params"> obj, callback, args </span>) </span>&#123;</span><br><span class="line">	<span class="comment">/*...*/</span></span><br><span class="line">	<span class="keyword">for</span> ( i <span class="keyword">in</span> obj ) &#123;</span><br><span class="line">		value = callback.call( obj[ i ], i, obj[ i ] );</span><br><span class="line">		<span class="keyword">if</span> ( value === <span class="literal">false</span> ) &#123;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* ... */</span></span><br><span class="line">	<span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>While for static <code>map</code>, the iteration won’t break, and <code>map</code> will put the callback results in a new array, and return the new array instead.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">map: <span class="function"><span class="keyword">function</span>(<span class="params"> elems, callback, arg </span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> ret = [],</span><br><span class="line">	<span class="comment">/* ... */</span></span><br><span class="line">	<span class="keyword">for</span> ( i <span class="keyword">in</span> elems ) &#123;</span><br><span class="line">		value = callback( elems[ i ], i, arg );</span><br><span class="line">	</span><br><span class="line">		<span class="keyword">if</span> ( value != <span class="literal">null</span> ) &#123;</span><br><span class="line">			ret.push( value );</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* ... */</span></span><br><span class="line">	<span class="keyword">return</span> concat.apply( [], ret );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Inner_Stack_And_Method_Chaining"><a href="#Inner_Stack_And_Method_Chaining" class="headerlink" title="Inner Stack And Method Chaining"></a>Inner Stack And Method Chaining</h2><p>I have mentioned that there is an inner stack inside jQuery, but that’s not real. To find the stack structure, let’s read the code below first.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// assume there are multiple divs</span></span><br><span class="line"><span class="keyword">var</span> a = $(<span class="string">"div"</span>);</span><br><span class="line"><span class="keyword">var</span> b = a.eq(<span class="number">0</span>);</span><br></pre></td></tr></table></figure></p>
<p>You will find a property named <code>prevObject</code> in <code>b</code>, and this property value points to <code>a</code>.<br>Most methods under <a href="http://api.jquery.com/category/traversing/" target="_blank" rel="external">traversing category</a> will finally call the <code>pushStack</code> method.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pushStack: <span class="function"><span class="keyword">function</span>(<span class="params"> elems </span>) </span>&#123;</span><br><span class="line">	<span class="comment">// Build a new jQuery matched element set</span></span><br><span class="line">	<span class="keyword">var</span> ret = jQuery.merge( <span class="keyword">this</span>.constructor(), elems );</span><br><span class="line">	<span class="comment">// Add the old object onto the stack (as a reference)</span></span><br><span class="line">	ret.prevObject = <span class="keyword">this</span>;</span><br><span class="line">	ret.context = <span class="keyword">this</span>.context;</span><br><span class="line">	<span class="comment">// Return the newly-formed element set</span></span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<p>So just like the comment said, this method will create a new jQuery object and set its <code>prevObject</code> to the object who calls the method, then return the new created object.<br>This is just like push a new element to the top of a stack.</p>
<p>So how can we get the previous elements from the stack ?<br>One choice is this method: <code>end</code>.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">end: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">this</span>.prevObject || <span class="keyword">this</span>.constructor(<span class="literal">null</span>);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<p>So we can chain these methods together, write code like below.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// assume we have 3 divs</span></span><br><span class="line"><span class="comment">// and we want to set their text one by one</span></span><br><span class="line">$(<span class="string">"div"</span>).eq(<span class="number">0</span>).text(<span class="string">"Michelangelo"</span>).end()</span><br><span class="line">		.eq(<span class="number">1</span>).text(<span class="string">"Leonardo da Vinci"</span>).end()</span><br><span class="line">		.eq(<span class="number">2</span>).text(<span class="string">"Raffaello Sanzio"</span>);</span><br></pre></td></tr></table></figure></p>
<p>See, I chained 3 tortoises together in one sentence.<br>For method chaining, somebody think it can help us write more readable code, but the others may hold the opposite opinion <a href="http://stackoverflow.com/questions/1103985/method-chaining-why-is-it-a-good-practice-or-not" target="_blank" rel="external">[1]</a> .<br>Anyway, method chaining’s a kind of common pattern in the JavaScript world. No matter you like it or not, you can use it when you need.</p>
<h2 id="Extend_Function"><a href="#Extend_Function" class="headerlink" title="Extend Function"></a>Extend Function</h2><p>If you read the source code through, you may find that jQuery use this function to extend new defined modules to <code>jQuery</code> and <code>jQuery.fn</code> everywhere.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// static version</span></span><br><span class="line">jQuery.extend( [deep ], target, object1 [, objectN ] )</span><br><span class="line"><span class="comment">// instance version</span></span><br><span class="line">jQuery.fn.extend( object )</span><br></pre></td></tr></table></figure></p>
<p>Actually static and instance version use the same function expression.<br><code>extend</code> function checks the number of parameters to distinguish these two situations. As the api above shows, for static version, there must be at least two parameters, while for the instance version, only one parameter is allowed.<br>Below is the definition.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">jQuery.extend = jQuery.fn.extend = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> options, name, src, copy, copyIsArray, clone,</span><br><span class="line">		target = <span class="built_in">arguments</span>[<span class="number">0</span>] || &#123;&#125;,</span><br><span class="line">		i = <span class="number">1</span>,</span><br><span class="line">		length = <span class="built_in">arguments</span>.length,</span><br><span class="line">		deep = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Handle a deep copy situation</span></span><br><span class="line">	<span class="keyword">if</span> ( <span class="keyword">typeof</span> target === <span class="string">"boolean"</span> ) &#123;</span><br><span class="line">		deep = target;</span><br><span class="line">		<span class="comment">// Skip the boolean and the target</span></span><br><span class="line">		target = <span class="built_in">arguments</span>[ i ] || &#123;&#125;;</span><br><span class="line">		i++;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Handle case when target is a string or something (possible in deep copy)</span></span><br><span class="line">	<span class="keyword">if</span> ( <span class="keyword">typeof</span> target !== <span class="string">"object"</span> &amp;&amp; !jQuery.isFunction(target) ) &#123;</span><br><span class="line">		target = &#123;&#125;;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Extend jQuery itself if only one argument is passed</span></span><br><span class="line">	<span class="comment">// For instance version, the target should be this.</span></span><br><span class="line">	<span class="keyword">if</span> ( i === length ) &#123;</span><br><span class="line">		target = <span class="keyword">this</span>;</span><br><span class="line">		i--;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> ( ; i &lt; length; i++ ) &#123;</span><br><span class="line">		<span class="comment">// Only deal with non-null/undefined values</span></span><br><span class="line">		<span class="keyword">if</span> ( (options = <span class="built_in">arguments</span>[ i ]) != <span class="literal">null</span> ) &#123;</span><br><span class="line">			<span class="comment">// Extend the base object</span></span><br><span class="line">			<span class="keyword">for</span> ( name <span class="keyword">in</span> options ) &#123;</span><br><span class="line">				src = target[ name ];</span><br><span class="line">				copy = options[ name ];</span><br><span class="line"></span><br><span class="line">				<span class="comment">// Prevent never-ending loop</span></span><br><span class="line">				<span class="keyword">if</span> ( target === copy ) &#123;</span><br><span class="line">					<span class="keyword">continue</span>;</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="comment">// Recurse if we're merging plain objects or arrays</span></span><br><span class="line">				<span class="keyword">if</span> ( deep &amp;&amp; copy &amp;&amp; ( jQuery.isPlainObject(copy) ||</span><br><span class="line">					(copyIsArray = jQuery.isArray(copy)) ) ) &#123;</span><br><span class="line"></span><br><span class="line">					<span class="keyword">if</span> ( copyIsArray ) &#123;</span><br><span class="line">						copyIsArray = <span class="literal">false</span>;</span><br><span class="line">						clone = src &amp;&amp; jQuery.isArray(src) ? src : [];</span><br><span class="line"></span><br><span class="line">					&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">						clone = src &amp;&amp; jQuery.isPlainObject(src) ? src : &#123;&#125;;</span><br><span class="line">					&#125;</span><br><span class="line"></span><br><span class="line">					<span class="comment">// Never move original objects, clone them</span></span><br><span class="line">					target[ name ] = jQuery.extend( deep, clone, copy );</span><br><span class="line"></span><br><span class="line">				<span class="comment">// Don't bring in undefined values</span></span><br><span class="line">				&#125; <span class="keyword">else</span> <span class="keyword">if</span> ( copy !== <span class="literal">undefined</span> ) &#123;</span><br><span class="line">					target[ name ] = copy;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// Return the modified object</span></span><br><span class="line">	<span class="keyword">return</span> target;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>Need to notice, the static version has a <code>deep</code> copy flag. When we set that as true, jQuery will merge copy to source in a recursive manner.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;arr: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]&#125;;</span><br><span class="line"><span class="keyword">var</span> b = &#123;arr: [<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>]&#125;;</span><br><span class="line"><span class="comment">// deep copy</span></span><br><span class="line">$.extend(<span class="literal">true</span>, a, b); <span class="comment">//a: &#123;arr: [5, 6, 7, 4]&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c = &#123;arr: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]&#125;;</span><br><span class="line"><span class="comment">// shallow copy, assign c.arr to a.arr directly</span></span><br><span class="line">$.extend(c, b); <span class="comment">// c: &#123;arr: [5, 6, 7]&#125;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Miscellaneous_Scaffold_Functions"><a href="#Miscellaneous_Scaffold_Functions" class="headerlink" title="Miscellaneous Scaffold Functions"></a>Miscellaneous Scaffold Functions</h2><p>jQuery also defines a lot of scaffold functions in core module. Let’s have a look at some of them.</p>
<ul>
<li><p><code>type</code> : here jQuery uses <code>Object.prototype.toString</code> to check type instead of <code>typeof</code> <a href="http://www.cnblogs.com/ziyunfei/archive/2012/11/05/2754156.html" target="_blank" rel="external">[2]</a> <a href="http://toddmotto.com/understanding-javascript-types-and-reliable-type-checking/" target="_blank" rel="external">[3]</a>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> class2type = &#123;&#125;,</span><br><span class="line">	toString = class2type.toString;</span><br><span class="line">	</span><br><span class="line">jQuery.each(<span class="string">"Boolean Number String Function Array Date RegExp Object Error"</span>.split(<span class="string">" "</span>),</span><br><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">i, name</span>) </span>&#123;</span><br><span class="line">	class2type[ <span class="string">"[object "</span> + name + <span class="string">"]"</span> ] = name.toLowerCase();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">type: <span class="function"><span class="keyword">function</span>(<span class="params"> obj </span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> ( obj == <span class="literal">null</span> ) &#123;</span><br><span class="line">		<span class="keyword">return</span> obj + <span class="string">""</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">typeof</span> obj === <span class="string">"object"</span> || <span class="keyword">typeof</span> obj === <span class="string">"function"</span> ?</span><br><span class="line">		class2type[ toString.call(obj) ] || <span class="string">"object"</span> :</span><br><span class="line">		<span class="keyword">typeof</span> obj;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>isPlainObject</code>: Check to see if an object is a plain object (created using “{}” or “new Object”).</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">isPlainObject: <span class="function"><span class="keyword">function</span>(<span class="params"> obj </span>) </span>&#123;</span><br><span class="line">	<span class="comment">// Not plain objects:</span></span><br><span class="line">	<span class="comment">// - Any object or value whose internal [[Class]] property is not "[object Object]"</span></span><br><span class="line">	<span class="comment">// - DOM nodes</span></span><br><span class="line">	<span class="comment">// - window</span></span><br><span class="line">	<span class="keyword">if</span> ( jQuery.type( obj ) !== <span class="string">"object"</span> || obj.nodeType || jQuery.isWindow( obj ) ) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// For objects created by calling `new fn()`</span></span><br><span class="line">	<span class="comment">// (new fn).constructor.prototype.hasOwnProperty('isPrototypeOf') == false</span></span><br><span class="line">	<span class="keyword">if</span> ( obj.constructor &amp;&amp;</span><br><span class="line">			!hasOwn.call( obj.constructor.prototype, <span class="string">"isPrototypeOf"</span> ) ) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// If the function hasn't returned already, we're confident that</span></span><br><span class="line">	<span class="comment">// |obj| is a plain object, created by &#123;&#125; or constructed with new Object</span></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Access"><a href="#Access" class="headerlink" title="Access"></a>Access</h2><p>Access is an entry for getting and setting values.<br>You can find it used in <code>jQuery.fn.attr</code>, <code>jQuery.fn.prop</code> and <code>jQuery.fn.css</code> functions.<br>Just as many other functions in jQuery, these functions have a lot of overloadings. <a href="http://www.cnblogs.com/hhstuhacker/p/jquery-access-source-advance.html" target="_blank" rel="external">[4]</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> target = $(<span class="string">"div"</span>);</span><br><span class="line">target.attr(<span class="string">"height"</span>);</span><br><span class="line">target.attr(<span class="string">"height"</span>, <span class="number">200</span>);</span><br><span class="line">target.attr(&#123;height: <span class="number">200</span>, width: <span class="number">100</span>&#125;);</span><br><span class="line">target.attr(<span class="string">"height"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">/* ... */</span> &#125;);</span><br></pre></td></tr></table></figure>
<p>But the code of <code>jQuery.fn.attr</code> is very simple.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">attr: <span class="function"><span class="keyword">function</span>(<span class="params"> name, value </span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> access( <span class="keyword">this</span>, jQuery.attr, name, value, <span class="built_in">arguments</span>.length &gt; <span class="number">1</span> );</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>Actually, jQuery extracts the logic for distinguishing these overloadings to <code>access</code>. </p>
<p>Let’s have a look at the definition of <code>access</code>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line"> * @elems : the target elements</span><br><span class="line"> * @fn: function that manipulates the target elements</span><br><span class="line"> * @key: prop name, such as "height"</span><br><span class="line"> * @value: prop value, such as 200</span><br><span class="line"> * @chainable: if the method can be chained, then this value is true, vice-versa.(get: false, set: true)</span><br><span class="line"> * @emptyGet: default value, will be used when the set of target elements is empty</span><br><span class="line"> * @raw: if value is data, then raw is true, if value is a function, then it will be false</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Multifunctional method to get and set values of a collection</span></span><br><span class="line"><span class="comment">// The value/s can optionally be executed if it's a function</span></span><br><span class="line"><span class="keyword">var</span> access = jQuery.access = <span class="function"><span class="keyword">function</span>(<span class="params"> elems, fn, key, value, chainable, emptyGet, raw </span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> i = <span class="number">0</span>,</span><br><span class="line">		length = elems.length,</span><br><span class="line">		bulk = key == <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Sets many values</span></span><br><span class="line">	<span class="keyword">if</span> ( jQuery.type( key ) === <span class="string">"object"</span> ) &#123;</span><br><span class="line">		chainable = <span class="literal">true</span>;</span><br><span class="line">		<span class="keyword">for</span> ( i <span class="keyword">in</span> key ) &#123;</span><br><span class="line">			jQuery.access( elems, fn, i, key[i], <span class="literal">true</span>, emptyGet, raw );</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Sets one value</span></span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> ( value !== <span class="literal">undefined</span> ) &#123;</span><br><span class="line">		chainable = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> ( !jQuery.isFunction( value ) ) &#123;</span><br><span class="line">			raw = <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> ( bulk ) &#123;</span><br><span class="line">			<span class="comment">// Bulk operations run against the entire set</span></span><br><span class="line">			<span class="keyword">if</span> ( raw ) &#123;</span><br><span class="line">				fn.call( elems, value );</span><br><span class="line">				fn = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// ...except when executing function values</span></span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				bulk = fn;</span><br><span class="line">				fn = <span class="function"><span class="keyword">function</span>(<span class="params"> elem, key, value </span>) </span>&#123;</span><br><span class="line">					<span class="keyword">return</span> bulk.call( jQuery( elem ), value );</span><br><span class="line">				&#125;;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> ( fn ) &#123;</span><br><span class="line">			<span class="keyword">for</span> ( ; i &lt; length; i++ ) &#123;</span><br><span class="line">				fn( elems[i], key, raw ? value : value.call( elems[i], i, fn( elems[i], key ) ) );</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> chainable ?</span><br><span class="line">		elems :</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Gets</span></span><br><span class="line">		bulk ?</span><br><span class="line">			fn.call( elems ) :</span><br><span class="line">			length ? fn( elems[<span class="number">0</span>], key ) : emptyGet;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://unicorn-42.com/2014/11/30/jQuery Source Code Study 2 - Core Module/" data-id="cihxkmen70000doq57imdrhdc" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jQuery/">jQuery</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2015/12/08/[译]安全基础：GPG, OpenSSH和OpenSSL/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          [译]安全基础：GPG, OpenSSH和OpenSSL
        
      </div>
    </a>
  
  
    <a href="/2014/11/25/jQuery Source Code Study 1 - Basic Structure/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">jQuery Source Code Study 1 - Basic Structure</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/jQuery/">jQuery</a><span class="tag-list-count">2</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/jQuery/" style="font-size: 10px;">jQuery</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2015/12/08/[译]安全基础：GPG, OpenSSH和OpenSSL/">[译]安全基础：GPG, OpenSSH和OpenSSL</a>
          </li>
        
          <li>
            <a href="/2014/11/30/jQuery Source Code Study 2 - Core Module/">jQuery Source Code Study 2 - Core Module</a>
          </li>
        
          <li>
            <a href="/2014/11/25/jQuery Source Code Study 1 - Basic Structure/">jQuery Source Code Study 1 - Basic Structure</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 byunicorn<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>